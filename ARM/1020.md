## 异常类型  
### 复位  
- 上电复位  
- 本地复位  
复位的优先级固定为3，最高优先级  
### 不可屏蔽中断NMI  
优先级为2，仅次于复位  
### 硬件故障  
处理程序执行时产生的错误  
### 请求管理调用  
### 可挂起的系统调用  
### 系统滴答  
### 外部中断  
只有用户使能外部中断的时候才能使用它。  

# Thumb指令集  
## 介绍  
在早期的ARM处理器中，采用ARM指令。它性能较高，功耗也较大。  
16位THUMB-1指令是ARM指令的子集。它的代码长度较小，同时性能也较低。  
通过多路复用器，可以同时使用THUMB指令和ARM指令。其实现原理是，由一个信号对两种指令进行选择。  

## Cortex-M0汇编语言格式  
```
标号
助记符 操作数1，操作数2，...;注释
```  

### 寄存器访问指令MOV  
```arm
mov R0,#0x31    ;将立即数31送到R0寄存器里面
MOV R0,R1       ;将R1寄存器的值送到R0寄存器里面
MOVS R0,R1      ;在复制寄存器内容的同时更新APSR寄存器的Z和N标志
MRS R0,CONTROL  ;将由SpecialReg标识的特殊寄存器的内容复制到R0里
MSR PRIMASK,R0  ;将R0的内容复制到特殊寄存器里面。该指令会影响ASPR寄存器的N、Z、C、V标志
```  

## 寄存器访问指令LOAD
以下指令都不会影响ASPR寄存器的标志位
```arm
LDR R0,[R1,R2]  ;将R1和R2寄存器的地址加和，从结果指向的寄存器中，取出一个数，放到R0寄存器里
LDRH R0,[R1,R2] ;将后面加和，从结果指向的地址中取出半个字放到R0的低16位中并将高16为清零
LDRB R0,[R1,R2] ;和上一个类似，但是是8个字
LDR R0,=0x1234  ;将立即数加载到寄存器R0中
LDRSH R0,[R1,R2];从后面的加和所指向的地址中取出半个字，放到R0的高16位。当第[15]位为1时，后面均用1填充；[15]位为0时，后面均用0填充。
LDRSB R0,[R1,R2];和上一个类似，但是是8位。
```

## 存储器访问指令STORE
不影响APSR的标志位
```arm
STR R0,[R1,R2]  ;将R0的数据复制到后面的加和所指向的地址单元中
STRH R0,[R1.R2] ;类比
STRB R0,[R1,,R2];类比
STR R0,[R1,#0x4];类比
```

## 多数据访问指令LDM和STM
```arm
LDM R0,{R1,R2-R7}   ;将R0指向的内容复制到R1里面，R0+4指向的内容复制到R2里面...
LDMIA R0!,{R1,R2-R7} ;将R1复制到R0，R2复制到R0+4，...和上一个是反的
```  

## 堆栈访问指令PUSH和POP
### PUSH
该指令将一个或多个寄存器保存到寄存器（入栈），并更新堆栈指针寄存器  
```arm
PUSH {R0,R1,R2}     ;将R0中的内容保存到SP-4指向的堆栈空间；R1的内容保存到SP-8指向的堆栈空间...
POP {R0,R1,R2}      ;将SP指向的内容放到R2中；将SP+4指向的内容放到R1中...
```

## 算数运算指令
### 加法指令  
```arm
ADDS R0,R1,R2   ;将R1和R2的内容相加，结果保存在R0里面，并更新APSR寄存器里的标志
ADDS R0,R1,#0x01;注意！后面的立即数范围是0~7
ADDS R0,#0x01   ;将R0与一个8位的立即数(0~255)相加，结果放在R0中,并立刻更新标志位
ADD R0,R1       ;将R0与R1相加，结果保存在R0中，不更新标志位
ADC R0,R1       ;将两寄存器的内容和进位标志相加，结果保存在R0中
ADR R3,JumpTable;将寄存器内容与标号所表示的偏移量相加，结果保存在寄存器里
```

### 减法指令
```arm
SUB R0,R1,R2    ;将R1减去R2，保存在R0里
SBC R0,R0,R1    ;将R0,R1的内容和错位标志相减，结果保存在R0中
```

### 乘法指令  
```arm
MUL R0,R1,R2    ;类比
```

### 比较指令
```arm
CMP R0,R1   ;比较R0和R1的内容，得到R0-R1的结果，但是不保存该结果，并更新标志
CMN R0,R1   ;比较两寄存器取反后内容，得到(R0)+(R1)的结果，但不保存，并更新APSR的标志
```

### 逻辑操作指令  
```ARM
ANDS R0,R1      ;将两寄存器进行逻辑与运算，结果保存在R0中，并更新标志。
ORRS R0,R1      ;或运算
EORS R0,R1      ;异或运算
MVNS R0,R1      ;将R1按位取反放到R0里，并更新标志
BICS R0,R1      ;将R1按位取反，然后与R0进行与运算，结果保存在R0中
TST R0,R1       ;将两者进行逻辑与运算，但是不保存任何结果，并更新标志位
```

### 移位操作运算  
ASR R0,R1       ;将R0中的数据右移R1所指定的次数，结果保存在R0寄存器里，最后移出去的位保存在C标志中。

# AHB-Lite规范  
是ARM和外部设备互联的基础。  
Lite版是简化版的。  
从软件上来讲,可以物理实现;从软件上来说,包括总线协议,如PCI总线协议  

## 总线分类  
内部总线和外部总线  
SoC的总线成为片上系统总线。  

## ARM AMBA系统总线  
AHB-Lite和APB用于M0,M3,M4。  
## AHB-Lite总线操作  
   地址总线选择一个外设  
   控制总线读操作,传输大小  
   数据总线