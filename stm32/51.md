# LED操作
IO口通过驱动器与寄存器相连。CPU通过配置寄存器即可控制IO口。

## 点亮LED
```C
#include <REGX52.H>
void main(){
    P2 = 0xFE;
    while(1){}
}
```
### 说明:
- 0xFE == 11111110;
- 一排LED都是连在P2寄存器上的,该寄存器有8位,每一位控制一个LED。这样就实现了只点亮一个LED。
- 单片机在执行完主函数之后会再重复执行主函数。为了避免这样的情况,需要在主函数的末尾加上while(1),相当于让函数暂停。

## LED闪烁
```C
#include <REGX52.H>
#include <INTRINS.H>
void Delay500ms();

void main(){
    while(1){
        P2 = 0xFE;
        Delay500ms();
        P2 = 0xFF;
        Delay500ms();    
    }
}

void Delay500ms()//11.0592MHz
{
	unsigned char i, j, k;

	_nop_();
	_nop_();
	i = 4;
	j = 205;
	k = 187;
	do
	{
		do
		{
			while (--k);
		} while (--j);
	} while (--i);
}
```
### 说明  
- 延时函数是程序根据晶振频率和指令集等自动生成的

# 按键控制LED  
四腿开关的结构示意
```txt
1     2
|__   |
|   __|
|__   | <--这里有个圆片
|     |    可使这三个脚接通
3     4
```
代码
```C
#include<REGX52.H>
void main(){
	P2_0 = 0;//直接操作P2的一位
	/*
	或者也可以这样？
	P2 = P2 & 0xFE;
	*/
	while(1){
		if(P3_1 == 0){
			P2_0 = 0;
		}
		else{
			P2_0 = 1;
		}
	}
}
```

## 按键消抖
背景知识:按键抖动的时间大约是5~10ms;稳定的时间大约是50~200ms
```C
while(1){
	if(/*按钮按下*/){
		Delay(/*约20ms*/);
		while(/*按钮按下*/);
		Delay();//过滤松手抖动
		//灯会在按钮被松开时做出反应
		P2_0 = ~P2_0;
	}
}
```

# 数码管
## 数码管的驱动
数码管分共阴极和共阳极两种。
### 对于只有一个数字的数码管:  
若为共阴极的,则需要将点亮的LED的端口设为高电平;反之亦然。  
### 对于四个数字连在一起的数码管:
这样的数码管有12个引脚。其中个IO口（位选端）决定LED一边的电平,8个决定另外一边的电平。  
也就是说,同一时间只有一个数码管可以亮。利用视觉暂留现象可以使它看起来像是四个都亮了。  
### 138译码器  
该原件可以使用三个输入口选中八个输出口之一

## 数码管的多位显示  
数码管消影
实现思路:每次段选之后,将段选清零,然后再选下一位。  
数码管有两种显示方式:单片机直接扫描和专用驱动芯片。前者会耗费大量的CPU时间。后者叫做TM1640。

## 串口通信  
单片机的串口可以使两个设备之间相互通信。VGA接口可以传输视频,而串口单纯只能传输数据。  
51内部自带通用异步收发器UART。  
串口的连接:VCC和GND相互连接,输出端和发送端交叉相连(TXD和RXD)。单向通信时可以只接一根线。当电平标准不一致时,需要加电平转换芯片。  
### 电平标准:传输过程中认为规定的数据与电平的对应关系  
- TTL电平:5v表示1,0v表示0
- RS232:-3~-15表示1,+3~+15表示0(反逻辑)  
- RS458:两线压差在一定范围内表示0/1  

比较复杂的会有流控制。  

### 相关术语:  
- UART __全双工__,__异步__,点对点  
- $I^2C$通信 使用引脚SCL、SDA,__半双工__,__同步__,可以挂载多个设备  
- SPI  
- 1-Wire DQ  
- USB  
- CAN,用于汽车  

### 相关术语  
- 全双工:通信双方可以在同一时刻互相传输数据  
- 半双工:可以互相传输数据,但必须分时复用用一根线  
- 单工:只能单向发送  
  
- 异步:双方各自约定通信速率  
- 同步:双方通过一根时钟线来约定通信速率  

- 总线:连接各个设备的数据传输线路。  

### 51单片机的UART  
常用模式:8位URT,波特率可变  

### 串口参数及时序图  
- 波特率:串口通信的速率(也就是异步约定好的速率)  
- 检验位:用于数据验证。奇偶校验:通过1的个数时奇数还是偶数来判断数据是否正确。